<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Solving the Game of SET: Part I - Refreshingly Dangerous</title>
<meta name="description" content="…or how to finally beat your wife in this dumb card game.">


  <meta name="author" content="Marc Micatka">
  
  <meta property="article:author" content="Marc Micatka">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Refreshingly Dangerous">
<meta property="og:title" content="Solving the Game of SET: Part I">
<meta property="og:url" content="http://localhost:4000/set/">


  <meta property="og:description" content="…or how to finally beat your wife in this dumb card game.">



  <meta property="og:image" content="http://localhost:4000/assets/images/set/set_thumbnail.png">





  <meta property="article:published_time" content="2020-04-14T00:00:00-07:00">



  <meta property="article:modified_time" content="2020-04-14T00:00:00-07:00">




<link rel="canonical" href="http://localhost:4000/set/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Refreshingly Dangerous Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png">
<link rel="manifest" href="/assets/images/site.webmanifest">
<link rel="mask-icon" href="/assets/images/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/images/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/images/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Refreshingly Dangerous
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/travel/">Travel</a>
            </li><li class="masthead__menu-item">
              <a href="/projects/">Projects</a>
            </li><li class="masthead__menu-item">
              <a href="/photography/">Photography</a>
            </li><li class="masthead__menu-item">
              <a href="/posts/">All Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/headshot.jpeg" alt="Marc Micatka" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Marc Micatka</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Occasional computer scientist, mechanical engineer, and traveler.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Seattle, WA</span>
        </li>
      

      

      
        <li>
          <a href="marcmicatka.com" itemprop="url">
            <i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span>
          </a>
        </li>
      

      
        <li>
          <a href="mailto:marc.micatka@gmail.com">
            <meta itemprop="email" content="marc.micatka@gmail.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span>
          </a>
        </li>
      

      

      

      

      
        <li>
          <a href="https://www.linkedin.com/in/marcmicatka" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span>
          </a>
        </li>
      

      

      

      

      

      
        <li>
          <a href="https://github.com/marc-micatka" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span>
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Solving the Game of SET: Part I">
    <meta itemprop="description" content="…or how to finally beat your wife in this dumb card game.">
    <meta itemprop="datePublished" content="2020-04-14T00:00:00-07:00">
    <meta itemprop="dateModified" content="2020-04-14T00:00:00-07:00">

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Solving the Game of SET: Part I
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <h3 id="game-of-set">Game of SET</h3>
<p>SET is a visual perception game consisting of a deck of 81 cards each with a combination of 4 features - shape (squiggle, diamond, or oval), fill (solid, empty, or hash), number (one, two or three), and color (red, green, or purple). 3^4 = 81 different cards. The game is played by shuffling the deck and dealing 12 cards out in a grid. A SET is made by combining three cards that have either share a common feature or are all different for that feature. For example, in the game below the red ovals in the upper right (single hash red oval, three empty red ovals, and two solid red ovals) form a set because they all either share a common feature (color, shape), or have all different features (fill, number).</p>
<figure>
    <a href="/assets/images/set/setgame2.jpg"><img src="/assets/images/set/setgame2.jpg" /></a>
    <figcaption> Example SET game.</figcaption>
</figure>

<p>This game is really hard for me. No matter my attempt at a strategy, I always end up panicking and scanning frantically. Combine my difficulty with my wife’s incredible speed and you got a computer vision project brewing!</p>

<h3 id="project-overview">Project Overview</h3>
<p>The goal of this project is to build a SET solving program using Python, OpenCV, and a webcam to generate solutions to displayed SET boards. Some constraints:</p>
<ul>
  <li>Analysis should happen in realtime - no taking pictures and uploading for analysis.</li>
  <li>Setup should be robust to various lighting conditions and viewing angles</li>
</ul>

<p>Because the cards are pretty simple, I decided to use deterministic methods for card identification and analysis.
Each card grid (which I’m calling a <em>scene</em>) will be processed to:</p>
<ul>
  <li>Find and count the number of cards present</li>
  <li>Segment each card for individual processing of:
    <ul>
      <li>Symbol Count</li>
      <li>Symbol Shape</li>
      <li>Symbol Color</li>
      <li>Symbol Fill</li>
    </ul>
  </li>
  <li>Using these values, game solutions will be solved and displayed.</li>
</ul>

<p>The program will be seperated into three major components:</p>
<ul>
  <li><em>ProcessScene</em>
    <ul>
      <li>Find each of our cards</li>
    </ul>
  </li>
  <li><em>ProcessCards</em>
    <ul>
      <li>ID the features of the card</li>
    </ul>
  </li>
  <li><em>PlayGame</em>
    <ul>
      <li>Solve the game and return the solution</li>
    </ul>
  </li>
</ul>

<h4 id="identifying-cards---processscene">Identifying Cards - ProcessScene</h4>
<p>The first step here is to find the number of cards in the scene. HSV filtering works really well here, especially when the glare coming off the glossy cards is minimized and the game is played on a non-white background.
Here’s the result of HSV filtering on an example game:</p>
<figure class="half">
    <a href="/assets/images/set/setgame2.jpg"><img src="/assets/images/set/setgame2.jpg" /></a>
<a href="/assets/images/set/hsv_set.png"><img src="/assets/images/set/hsv_set.png" /></a>
    <figcaption>Example game and the corresponding HSV filtered image.</figcaption>
</figure>

<p>We can easily use this image to run some contours and extract our image.
After extracting the contours, I only keep the contours that have four points and exceed a pre-set threshold. I also check to make sure that the shape we’ve found is a rectangle. This is done by calculating the four corner angles. With a skewed viewing angle, they won’t necessarily be perfect right angles, but they should fall in a range.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">is_rect</span><span class="p">(</span><span class="n">pts</span><span class="p">):</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">pts</span><span class="p">).</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">order_pts</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
    <span class="n">x_pts</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">pts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">y_pts</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">pts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Calculate all four angles
</span>    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x_pts</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">y_pts</span><span class="p">))</span>

    <span class="c1"># Correct angles based on initial line segment
</span>    <span class="n">theta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">angle_trunc</span><span class="p">(</span><span class="n">theta</span> <span class="o">-</span> <span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="c1"># print (theta)
</span>    <span class="n">angle_min</span> <span class="o">=</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">angle_max</span> <span class="o">=</span> <span class="mf">1.3</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">angle_test</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">theta</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">theta</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">),</span>
                                        <span class="n">np</span><span class="p">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">theta</span> <span class="o">&gt;</span> <span class="n">angle_min</span><span class="p">,</span> <span class="n">theta</span> <span class="o">&lt;</span> <span class="n">angle_max</span><span class="p">)))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">angle_test</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
</code></pre></div></div>
<p>Combined with our HSV filter and Gaussian blurring, this eliminates a lot of noise and false positives from our search space.
Once our cards are extracted, we warp them to a fixed size to correct for camera angles. This also makes our life a lot easier when extracting shapes later as the shapes will all be the same size and un-skewed. We have to do some trickier to account for images that could be in view but sideways, we don’t want to accidently force a rotated card to fit in the box we’ve defined.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">warp_cards</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
    <span class="n">new_width</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">new_height</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">)</span> <span class="o">*</span> <span class="n">new_width</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">rect</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s">"float32"</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">pts</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">rect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>
    <span class="n">rect</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>

    <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">rect</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">diff</span><span class="p">)]</span>
    <span class="n">rect</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">diff</span><span class="p">)]</span>
    <span class="p">(</span><span class="n">tl</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span> <span class="n">br</span><span class="p">,</span> <span class="n">bl</span><span class="p">)</span> <span class="o">=</span> <span class="n">rect</span>

    <span class="n">top_len</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="n">norm</span><span class="p">(</span><span class="n">tl</span><span class="o">-</span><span class="n">tr</span><span class="p">)</span>
    <span class="n">side_len</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="n">norm</span><span class="p">(</span><span class="n">tr</span><span class="o">-</span><span class="n">br</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">side_len</span> <span class="o">&gt;</span> <span class="n">top_len</span><span class="p">:</span>
        <span class="n">rect</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">roll</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">(</span><span class="n">tl</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span> <span class="n">br</span><span class="p">,</span> <span class="n">bl</span><span class="p">)</span> <span class="o">=</span> <span class="n">rect</span>

    <span class="n">maxWidth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_width</span><span class="p">)</span>
    <span class="n">maxHeight</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_height</span><span class="p">)</span>
    <span class="c1"># construct our destination points
</span>    <span class="n">dst</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="n">maxWidth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="n">maxWidth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">maxHeight</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxHeight</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">"float32"</span><span class="p">)</span>
    <span class="c1"># warp the image
</span>    <span class="n">M</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">getPerspectiveTransform</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
    <span class="n">warped</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">warpPerspective</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="p">(</span><span class="n">maxWidth</span><span class="p">,</span> <span class="n">maxHeight</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">warped</span>
</code></pre></div></div>
<p>Now all our cards are isolated and each card has been extracted, warped to the same size and rotated to the same angle.
The order is different from that displayed in the scene, but this isn’t actually important as the game doesn’t depend on the location of the cards relative to each other. All we need to do is keep the location <em>consistent</em> between frames - this is important when we move to a webcam instead of still images - and maintain the (x,y) coordinates of the card in the scene.</p>
<figure class="half">
    <a href="/assets/images/set/card_contours.png"><img src="/assets/images/set/card_contours.png" /></a>
    <a href="/assets/images/set/setgame_warp.png"><img src="/assets/images/set/setgame_warp.png" /></a>
    <figcaption>Bounding box around each card and the grid of cards found, isolated, and warped.</figcaption>
</figure>

<h4 id="identifying-card-features---processcard">Identifying Card Features - ProcessCard</h4>
<p>Once the cards have been isolated, we can being identifying the features of the card. Some of these features are pretty trivial to find and the methods produce very robust results (card count and symbol shape). The other features (card color and card fill) are a bit less robust and more difficult to identify correctly. Some of this is because of the quality of the webcam - hatch fill can get blurred by a low quality image.</p>

<h5 id="find-number-of-symbols">Find Number of Symbols</h5>
<p>This is done using contours to extract the symbol outlines and count the number of features extracted. Much like the cards, we use an area threshold to avoid getting small contours and then count the result. This one was pretty easy and very robust.</p>

<h5 id="find-shape-of-symbols">Find Shape of Symbols</h5>
<p>Finding the shape was a bit trickier than the count. Diamonds are really straightforward because of their distinct points. We can easily look at the contours and count the number of points in line approximation. Squiggles and ovals are trickier to tell apart with this method. I ended up using a simple error metric between a template image and the found image.</p>
<figure class="half">
    <a href="/assets/images/set/draw_number.png"><img src="/assets/images/set/draw_number.png" /></a>
    <a href="/assets/images/set/draw_symbol.png"><img src="/assets/images/set/draw_symbol.png" /></a>
    <figcaption>Scene with symbol count and shape identified.</figcaption>
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">find_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">side_array</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">contours</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pts</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">contours</span><span class="p">:</span>
            <span class="n">side_array</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pts</span><span class="p">))</span>
    <span class="n">side_mean</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">side_array</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">bw_sym_img</span> <span class="o">=</span> <span class="n">bw_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">symbol_img</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">thresh_sym</span> <span class="o">=</span> <span class="n">threshold_img</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">bw_sym_img</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">filled_sym</span> <span class="o">=</span> <span class="n">flood_fill</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">thresh_sym</span><span class="p">)</span>
    <span class="k">if</span> <span class="mf">3.5</span> <span class="o">&lt;</span> <span class="n">side_mean</span> <span class="o">&lt;</span> <span class="mf">6.0</span><span class="p">:</span>
        <span class="n">shape_str</span> <span class="o">=</span> <span class="s">'Diamond'</span>
        <span class="n">shape_idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">err</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">shapes</span> <span class="ow">in</span> <span class="n">TEMPLATE_ARRAY</span><span class="p">:</span>
            <span class="n">cmp_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">resize_to_shape</span><span class="p">(</span><span class="n">shapes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="p">.</span><span class="n">filled_sym</span><span class="p">)</span>
            <span class="n">err</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">ssim</span><span class="p">(</span><span class="n">cmp_shape</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">filled_sym</span><span class="p">))</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="n">shape_idx</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">shape_str</span> <span class="o">=</span> <span class="n">TEMPLATE_ARRAY</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">err</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span>

    <span class="bp">self</span><span class="p">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">shape_idx</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">shape_str</span> <span class="o">=</span> <span class="n">shape_str</span>
</code></pre></div></div>

<figure class="align-right" style="width: 400px">
    <a href="/assets/images/set/masked_symbols.png"><img src="/assets/images/set/masked_symbols.png" /></a>
    <figcaption>Masked symbols showing extracted color regions..</figcaption>
</figure>
<h5 id="find-color-and-fill-of-symbols">Find Color and Fill of Symbols</h5>
<p>Color was really tricky. I tried a number of methods that achieved mediocre results, at best. HSV filtering wasn’t robust enough to identify the colors of non-solid shapes. The problem I was facing is that color is constrained to only small regions of the empty/hash cards. Because the empty card is almost entirely white, I first needed to find a way to extract just the colored region. I settled on using a bitwise mask to extract the colored parts using a thresholded version of the card. This does a pretty reasonable job of extracting just the colored region.</p>

<p>Using this image, I estimate the mean of the vibrance channel from the HSV image. I’ve created some bins for each color based on the hue value and add each pixel based on which color range it falls in. Whichever color bin has the highest count is chosen as the correct color.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">find_color</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">sym_mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">symbol_img</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">symbol_img</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">thresh_sym</span><span class="p">)</span>
    <span class="n">sym_hsv</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">sym_mask</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_BGR2HSV</span><span class="p">)</span>
    <span class="n">norm_hsv</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">normalize_patch</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_BGR2HSV</span><span class="p">)</span>
    <span class="n">norm_mean</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">norm_hsv</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">hue</span> <span class="o">=</span> <span class="n">sym_hsv</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">sym_mean</span> <span class="o">=</span> <span class="n">hue</span><span class="p">[</span><span class="n">hue</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">].</span><span class="n">flatten</span><span class="p">()</span>

    <span class="n">purple_mean</span> <span class="o">=</span> <span class="p">((</span><span class="n">sym_mean</span> <span class="o">&gt;</span> <span class="mi">115</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sym_mean</span> <span class="o">&lt;</span> <span class="mi">160</span><span class="p">)).</span><span class="nb">sum</span><span class="p">()</span>
    <span class="n">green_mean</span> <span class="o">=</span> <span class="p">((</span><span class="n">sym_mean</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sym_mean</span> <span class="o">&lt;</span> <span class="mi">90</span><span class="p">)).</span><span class="nb">sum</span><span class="p">()</span>
    <span class="n">red_mean</span> <span class="o">=</span> <span class="p">((</span><span class="n">sym_mean</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sym_mean</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)).</span><span class="nb">sum</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="n">sym_mean</span> <span class="o">&gt;</span> <span class="mi">175</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span>
    <span class="n">color_choice</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="n">red_mean</span><span class="p">,</span> <span class="n">green_mean</span><span class="p">,</span> <span class="n">purple_mean</span><span class="p">])</span>

    <span class="bp">self</span><span class="p">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">color_choice</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">color_str</span> <span class="o">=</span> <span class="n">COLOR_STR</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">color</span><span class="p">]</span>
</code></pre></div></div>
<p>I ended up being pretty pleased with these results and found really robust identification even with the empty and hash cards.</p>

<p>To find the fill of the image, I extract a small patch from the center of the symbol and a small patch from the corner to use as an example of a known color (white). Solid fills are pretty easy to determine based on the mse between the extracted patch and the normal patch.
Hash and empty patches are tougher to distinguish between based on the poor webcam quality. I get good results from using a Canny edge detector and then checking if there are stripes in the extracted patch.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">find_fill</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">height</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">symbol_img</span><span class="p">.</span><span class="n">shape</span>

    <span class="n">h_min</span><span class="p">,</span> <span class="n">h_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">height</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">height</span>
    <span class="n">w_min</span><span class="p">,</span> <span class="n">w_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">w</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">width</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">w</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">width</span>

    <span class="bp">self</span><span class="p">.</span><span class="n">normalize_patch</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">warp</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">height</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">width</span><span class="p">,</span> <span class="p">:]</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">fill_patch</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">symbol_img</span><span class="p">[</span><span class="n">h_min</span><span class="p">:</span><span class="n">h_max</span><span class="p">,</span> <span class="n">w_min</span><span class="p">:</span><span class="n">w_max</span><span class="p">]</span>

    <span class="n">normal_mean</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">normalize_patch</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">patch_mean</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">fill_patch</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="n">mse</span><span class="p">(</span><span class="n">normal_mean</span><span class="p">,</span> <span class="n">patch_mean</span><span class="p">)</span>

    <span class="n">sym_edge</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">Canny</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">fill_patch</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">fill_cnt</span> <span class="o">=</span> <span class="p">(</span><span class="n">sym_edge</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">distance</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">fill</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">fill_str</span> <span class="o">=</span> <span class="s">'Solid'</span>

    <span class="k">elif</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">fill_cnt</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">fill</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">fill_str</span> <span class="o">=</span> <span class="s">'Empty'</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">fill</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">fill_str</span> <span class="o">=</span> <span class="s">'Hash'</span>
</code></pre></div></div>

<h4 id="solving-the-game---playgame">Solving the Game - PlayGame</h4>
<p>Once all the cards have been identified, it’s time to solve the game!
Each card is encoded as a list of integers 1 to 3. To come up with the solutions, I went for a pretty brute force approach. This was in part because it was far easier than optimzing the algorithm and because the actual solution is a very small fraction of the total solution time. Optimizing the solution algorithm would have been interesting, but not particularily useful.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">solve_single</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">card_array</span><span class="p">),</span> <span class="mi">3</span><span class="p">):</span>
        <span class="n">test</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">card</span><span class="p">)</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="n">test</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">card</span> <span class="o">=</span> <span class="n">test</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">are_valid_set</span><span class="p">(</span><span class="n">card</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">solutions</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">indexes</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">solution</span> <span class="o">=</span> <span class="n">indexes</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">solved</span> <span class="o">=</span> <span class="bp">True</span>
</code></pre></div></div>
<figure class="align-center">
    <a href="/assets/images/set/solution.png"><img src="/assets/images/set/solution.png" /></a>
    <figcaption>Solved scene!.</figcaption>
</figure>

<h4 id="solving-the-game---video">Solving the Game - Video</h4>
<p>Now that I have a working solution for static images, we can port the solution to work on videos.
To make this work better, I use a running average of frames using ‘cv2.accumulateWeighted()’. This helps reduce noise and make our solution more stable. I also updated my solution to find a solution over a frame buffer - again this is designed to introduce stability. I check the solution of a scene over 5 consecutive frames and use only the card identities that remain the same.</p>

<p>I tried this method and left all the cards in place, hoping to see a stable output.</p>

<p>Here’s the cards being identified:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/KRShGSQvLHI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>

<p>This isn’t <em>too</em> bad, but there’s definitely some jitters in some of the  values. Drawing the solution:</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/3HQy8-wSRLc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>

<p>Crap. My initial method doesn’t keep the cards in the same spot so the array constantly re-sorts the order. In fact, the array order will be based on the contour area, as that’s the last time we sorted the cards. This results in a solution that constantly jumps around.
I have a few options/methods to fix this. I re-sort the cards based on their found x-y location to keep the location in the array consistent. I don’t need to have a really logical sort, just as long as it’s consistent. Or I could try and sort my found solution so I don’t change solutions between frames. I’m not sure what will work better and the results of my testing will have to wait for <a href="/set2/" target="_blank">Part II</a>!</p>


        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#computer-vision" class="page__taxonomy-item" rel="tag">Computer Vision</a><span class="sep">, </span>
    
      <a href="/tags/#projects" class="page__taxonomy-item" rel="tag">Projects</a>
    
    </span>
  </p>




        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-04-14">April 14, 2020</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/mhi/" class="pagination--pager" title="Motion History Images for Activity Identification
">Previous</a>
    
    
      <a href="/tracking/" class="pagination--pager" title="Particle Filters and Mitt Romney
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="https://live.staticflickr.com/65535/52307186058_67f7474d47_o.jpg" alt="">
      </div>
    
    
    <h2 class="archive__item-title" itemprop="headline">
    
      
        <a href="/winds3/" rel="permalink">Wind River Range - 2020 (Part 1)
</a>
      
        


    </h2>


      <p class="archive__item-excerpt" itemprop="description">Back for More. Again. Part 1.
</p>
      

    

    
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/kbai/ravens_thumbnail.png" alt="">
      </div>
    
    
    <h2 class="archive__item-title" itemprop="headline">
    
      
        <a href="/lamp/" rel="permalink">An AI Agent for Solving Raven’s Progressive Matrices
</a>
      
        


    </h2>


      <p class="archive__item-excerpt" itemprop="description">OMSCS 7637 KBAI - Fall 2019
</p>
      

    

    
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="https://farm66.staticflickr.com/65535/52306070656_b55f97890b.jpg" alt="">
      </div>
    
    
    <h2 class="archive__item-title" itemprop="headline">
    
      
        <a href="/ptarmigan/" rel="permalink">North Cascades - Ptarmigan Loop
</a>
      
        


    </h2>


      <p class="archive__item-excerpt" itemprop="description">High peaks and bushwacking.
</p>
      

    

    
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/rainier/thumbnail.jpg" alt="">
      </div>
    
    
    <h2 class="archive__item-title" itemprop="headline">
    
      
        <a href="/rainier/" rel="permalink">Skiing Camp Muir
</a>
      
        


    </h2>


      <p class="archive__item-excerpt" itemprop="description">Ross shreds, Marc…manages.
</p>
      

    

    
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://www.linkedin.com/in/marcmicatka/" rel="nofollow noopener noreferrer"><i class="fab fa-linkedin-in" aria-hidden="true"></i> LinkedIn</a></li>
        
      
        
          <li><a href="https://github.com/marc-micatka" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="marc.micatka@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
        
      
    

  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 Refreshingly Dangerous. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
